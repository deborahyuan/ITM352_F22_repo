<script>
  app.post("/purchase", function (request, response) { // process form by redirecting to the receipt page
   function isNonNegativeInteger(queryString, returnErrors = false) {
      errors = []; // assume no errors at first
      if(Number(queryString) != queryString) errors.push('Not a number!'); // Check if string is a number value
    if(queryString < 0) errors.push('Negative value!'); // Check if it is non-negative
    if(parseInt(queryString) != queryString) errors.push('Not an integer!'); // Check that it is an integer
   
      if (returnErrors) {
          return errors;
      } else if (errors.length == 0) {
          return true;
      } else {
          return false;
      }
   }
   receipt = '';
   let qtys = request.body[`quantity_textbox`];
   for (i in qtys) {
       q = qtys[i];
       let brand = products[i]['name'];
       let brand_price = products[i]['price'];
       if (isNonNegativeInteger(q)) {
           products[i]['total_sold'] += Number(q);
           receipt += `<h3>Thank you for purchasing: ${q} ${brand}. Your total is $${q * brand_price}!</h3>`; // render template string
       } else {
           receipt += `<h3><font color="red">${q} is not a valid quantity for ${brand}!, ${isNonNegativeInteger(q)}</font></h3>`; // NEEDS ATTENTION!
       }
   }
   response.send(receipt);
   response.end();})

</script>
